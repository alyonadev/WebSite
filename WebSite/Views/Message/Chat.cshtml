@{
    ViewBag.Title = "Chat";

}

<input type="hidden" id="fromName" value="@ViewBag.FromUser.Name" />
<input type="hidden" id="toName" value="@ViewBag.ToUser.Name" />
<input type="hidden" id="fromUserId" value="@ViewBag.FromUser.UserId" />
<input type="hidden" id="toUserId" value="@ViewBag.ToUser.UserId" />

<h1>Chat room</h1>

<div class="form-group">
    <label for="message" >Message</label><br/>
    <textarea type="text" id="message" class="form-control" placeholder="Message..."></textarea>
</div><br/>

<button type="button" class="btn btn-success" id="sendmessage">Send</button>

<div class="form-group">
    <label for="chat">Message history</label><br />
    <div id="chat" class="card">
        @foreach (var message in Model)
        {
            <h5 class="card-title">
                @if (message.From == ViewBag.FromUser.UserId)
                {
                    @ViewBag.FromUser.Name
                }
                else
                {
                    @ViewBag.ToUser.Name
                }
            </h5>
            <p class="card-text">@message.Text</p>
            <p class="card-text"><small class="text-muted">Address:@message.Date</small></p>
        }
    </div>
</div>

@section scripts{
    <script src="~/Scripts/jquery.signalR-2.4.1.js"></script>
    <script src="~/signalr/hubs"></script>

    <script>
        $(function () {
            var chat = $.connection.chatHub;

            chat.client.sendMessageAsync = function (from, message) {

                $('#chat').append('<p><b>' + from + '</b>: ' + message + '</p>');
            };

            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    chat.server.send(
                        $('#fromUserId').val(),
                        $('#toUserId').val(),
                        $('#fromName').val(),
                        $('#message').val());
                    $('#message').val('').focus();
                });
            });
        });

    </script>

}



