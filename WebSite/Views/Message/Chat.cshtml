@{
    ViewBag.Title = "Chat";

}

<input type="hidden" id="fromName" value="@ViewBag.FromUser.Name" />
<input type="hidden" id="toName" value="@ViewBag.ToUser.Name" />
<input type="hidden" id="fromUserId" value="@ViewBag.FromUser.UserId" />
<input type="hidden" id="toUserId" value="@ViewBag.ToUser.UserId" />

<h1>Чат комната</h1>

<div class="form-group">
    <label for="message" >Сообщение</label><br/>
    <textarea type="text" id="message" class="form-control" placeholder="Сообщение..."></textarea>
</div><br/>

<button type="button" class="btn btn-success" id="sendmessage">Отправить</button>

<div class="form-group">
    <label for="chat">История сообщений</label><br />
    <ul id="chat">
        @foreach (var message in Model)
        {
            if (message.From == ViewBag.FromUser.UserId)
            {
                <li><b>@ViewBag.FromUser.Name</b>: @message.Text</li>
            }
            else
            {
                <li><b>@ViewBag.ToUser.Name</b>: @message.Text</li>
            }
        }
    </ul>
</div>

@section scripts{
    <script src="~/Scripts/jquery.signalR-2.4.1.js"></script>
    <script src="~/signalr/hubs"></script>

    <script>
        $(function () {
            var chat = $.connection.chatHub;

            chat.client.sendMessageAsync = function (from, message) {

                $('#chat').append('<li><b>' + from + '</b>: ' + message + '</li>');
            };

            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    chat.server.send(
                        $('#fromUserId').val(),
                        $('#toUserId').val(),
                        $('#fromName').val(),
                        $('#message').val());
                    $('#message').val('').focus();
                });
            });
        });

    </script>

}



